var e=Object.assign;import{d as a,c as t,a as s,F as n,r,w as o,p as l,b as c,o as d,e as u,f as i,t as p,g as m,h as v,i as h,l as g,j as y,k as f,v as b,m as D,n as w,D as I,q as S,s as _,u as k,x as T,y as M,z as F}from"./vendor.25c0c159.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(t){const s=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((t,r)=>{const o=new URL(e,s);if(self[a].moduleMap[o])return t(self[a].moduleMap[o]);const l=new Blob([`import * as m from '${o}';`,`${a}.moduleMap['${o}']=m;`],{type:"text/javascript"}),c=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){r(new Error(`Failed to import: ${e}`)),n(c)},onload(){t(self[a].moduleMap[o]),n(c)}});document.head.appendChild(c)})),self[a].moduleMap={}}}("/assets/");var R=a({props:{loading:Boolean,noresult:Boolean,users:{type:Array,required:!0}},setup:(e,{emit:a})=>({clearUsers:()=>{a("update:users",[])}})});const $=o("data-v-91ec77d2");l("data-v-91ec77d2");const P={key:0},U={key:1};c();const j=$(((e,a,o,l,c,v)=>{const h=m("router-link");return d(),t("ul",null,[e.loading?(d(),t("li",P,"Searching...")):s("",!0),e.loading||!e.noresult||e.users.length?s("",!0):(d(),t("li",U,"No player found...")),e.users&&e.users.length&&!e.loading&&!e.noresult?(d(!0),t(n,{key:2},r(e.users,(a=>(d(),t("li",{key:`${a.membershipType}-${a.membershipId}`},[u(h,{to:{name:"Timeline",params:{membershipType:a.membershipType,membershipId:a.membershipId}},onClickPassive:e.clearUsers},{default:$((()=>[i(p(a.displayName),1)])),_:2},1032,["to","onClickPassive"])])))),128)):s("",!0)])}));R.render=j,R.__scopeId="data-v-91ec77d2";const C=v.create({baseURL:"https://stats.bungie.net/Platform/",headers:{"X-Api-Key":"457b1436a98a4390be099a140c42fd3d"}});var L=a({components:{SearchResult:R},setup(){const e=h([]),a=h(!1),t=h(!1),s=h(""),n=g.debounce((async()=>{if(e.value=[],a.value=!1,s.value&&s.value)try{t.value=!0;const{data:n}=await C.get(`Destiny2/SearchDestinyPlayer/-1/${encodeURIComponent(s.value.trim())}/`),r=n;r.Response.length?e.value=r.Response.filter(((e,a,t)=>a===t.findIndex((a=>a.membershipType===e.membershipType&&a.membershipId===e.membershipId)))):a.value=!0}catch(n){e.value=[]}finally{t.value=!1}}),250);return y(s,n),{gamertag:s,users:e,loading:t,noresult:a}}});const Y=o("data-v-bb5171f8")(((e,a,s,n,r,o)=>{const l=m("SearchResult");return d(),t("div",null,[f(u("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=a=>e.gamertag=a),autofocus:"",placeholder:"Gamertag..."},null,512),[[b,e.gamertag]]),u(l,{users:e.users,"onUpdate:users":a[2]||(a[2]=a=>e.users=a),loading:e.loading,noresult:e.noresult},null,8,["users","loading","noresult"])])}));L.render=Y,L.__scopeId="data-v-bb5171f8";var x=a({components:{Search:L}});const N=o("data-v-3d45261a")(((e,a,s,r,o,l)=>{const c=m("router-view"),i=m("Search");return d(),t(n,null,[u("main",null,[u(c)]),u(i)],64)}));x.render=N,x.__scopeId="data-v-3d45261a";const E={};E.render=function(e,a){return d(),t("span",null,"Welcome")};const O=v.CancelToken.source();var A=(()=>{const a=w({profile:null,activities:[],dates:{},flatDates:[]}),t=()=>{a.dates={},a.flatDates=[];const e=new Date("2017, Sept 1"),t=new Date;for(;e<=t;)a.dates[e.getFullYear()]||(a.dates[e.getFullYear()]={}),a.dates[e.getFullYear()][e.getMonth()+1]||(a.dates[e.getFullYear()][e.getMonth()+1]={}),a.dates[e.getFullYear()][e.getMonth()+1][e.getDate()]||(a.dates[e.getFullYear()][e.getMonth()+1][e.getDate()]=[]),a.flatDates.push(new Date(e)),e.setDate(e.getDate()+1)},s=async(e,t)=>{const s=(await C.get(`Destiny2/${e}/Profile/${t}/`,{params:{components:[I.Profiles,I.Characters].join(",")}})).data.Response,r=(e=>{if(!e.characters.data)throw new Error("Characters not found on response");return Object.keys(e.characters.data).map((a=>{var t;return(null!=(t=e.characters.data)?t:{})[a]})).sort(((e,a)=>e.dateLastPlayed<a.dateLastPlayed?1:-1))})(s);a.profile=s,r.forEach((e=>{n(e,0),n(e,1),n(e,2)}))},n=async(t,s)=>{try{const r=(await C.get(`Destiny2/${t.membershipType}/Account/${t.membershipId}/Character/${t.characterId}/Stats/Activities/`,{params:{count:250,page:s,mode:S.None},cancelToken:O.token})).data.Response.activities;r&&r.length&&(r.forEach((t=>{const s=new Date(t.period);s.setSeconds(s.getSeconds()+t.values.startSeconds.basic.value);const n=new Date(s.getTime());n.setSeconds(s.getSeconds()+t.values.timePlayedSeconds.basic.value);const r=e(e({},t),{startDate:s,endDate:n});a.activities.push(r);const o=new Date(r.period);try{a.dates[o.getFullYear()][o.getMonth()+1][o.getDate()].push(r)}catch(l){console.log(o)}})),n(t,s+3))}catch(r){v.isCancel(r)&&console.log("search canceled")}},r=_((()=>a.flatDates.map((e=>{var t,s;const n=null==(s=null==(t=a.dates[e.getFullYear()])?void 0:t[e.getMonth()+1])?void 0:s[e.getDate()];return n?n.reduce(((e,a)=>e+a.values.timePlayedSeconds.basic.value),0):0})).sort(((e,a)=>e>a?-1:1))[0]));return{state:D(a),maxTime:r,startSearch:(e,n)=>{a.profile=null,a.activities=[],t(),s(e,n)},cancel:O.cancel}})(),q=a({props:{day:{type:Date,required:!0}},setup(e){const a=Intl.DateTimeFormat(),t=_((()=>{var a,t;const s=e.day,n=null==(t=null==(a=A.state.dates[s.getFullYear()])?void 0:a[s.getMonth()+1])?void 0:t[s.getDate()];return n?n.reduce(((e,a)=>e+a.values.timePlayedSeconds.basic.value),0):0})),s=_((()=>t.value?t.value/A.maxTime.value*100:0));return{style:_((()=>({height:`${s.value}%`}))),title:_((()=>{const s=Math.trunc(t.value/60/60),n=Math.trunc(t.value/60);t.value,t.value;a.format(e.day)}))}}});const B=o("data-v-5c15cf0a")(((e,a,s,n,r,o)=>(d(),t("div",{class:"day",style:e.style},null,4))));q.render=B,q.__scopeId="data-v-5c15cf0a";const z={},G=o("data-v-6de0d51a");l("data-v-6de0d51a");const H={class:"no-data"},K=u("p",null,"no data",-1);c();const V=G(((e,a)=>(d(),t("div",H,[K]))));z.render=V,z.__scopeId="data-v-6de0d51a";var W=a({components:{Day:q,NoData:z},setup(){const e=k();return y((()=>e.params),(async e=>{const a=e.membershipType,t=e.membershipId;a&&t&&(A.state.profile&&A.cancel(),A.startSearch(a,t))}),{immediate:!0}),{state:A.state}}});const X=o("data-v-10b19494");l("data-v-10b19494");const J={class:"timeline"};c();const Q=X(((e,a,s,o,l,c)=>{const u=m("NoData"),i=m("Day");return d(),t("div",J,[e.state.flatDates&&e.state.flatDates.length?(d(!0),t(n,{key:1},r(e.state.flatDates,(e=>(d(),t(i,{key:e,day:e},null,8,["day"])))),128)):(d(),t(u,{key:0}))])}));W.render=Q,W.__scopeId="data-v-10b19494";const Z=T({routes:[{name:"Home",path:"/",component:E},{name:"Timeline",path:"/:membershipType/:membershipId",component:W},{name:"NotFound",path:"/:pathMatch(.*)*",redirect:"/"}],history:M()});F(x).use(Z).mount("#app");
